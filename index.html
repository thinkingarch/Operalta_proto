<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operalta — Platform Prototype</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
        
        :root {
            --grid-color: #f0f0f0;
            --accent: #5B21B6;
            --color-recording: #ff3b30;
            --glass-bg: rgba(255, 255, 255, 0.65);
            --glass-border: rgba(0, 0, 0, 0.07);
            --glass-shadow: rgba(0, 0, 0, 0.05);
            --glass-recording-bg: rgba(248, 248, 248, 0.75);
            --glass-recording-border: rgba(0, 0, 0, 0.1);
        }
        
        body {
            font-family: 'Space Grotesk', -apple-system, sans-serif;
            background-color: #f9fafb;
        }
        
        .mono {
            font-family: 'Space Mono', monospace;
        }

        .baseline-grid {
            background-image: linear-gradient(var(--grid-color) 1px, transparent 1px);
            background-size: 100% 16px;
        }
        
        .sidebar-link { transition: all 0.2s ease; }
        .sidebar-link:hover, .sidebar-link.active { background-color: #f3f4f6; color: #111827; }
        .sidebar-link.active { font-weight: 600; }
        #sidebar { transition: transform 0.3s ease-in-out; }

        /* CEO/VC Toggle Switch */
        .toggle-dot { transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        input:checked ~ .toggle-bg { background-color: var(--accent); }
        input:checked ~ .toggle-dot { transform: translateX(100%); }

        /* Dictation App Styles Integration */
        .recording-interface {
            transition: all 0.45s ease-in-out;
            z-index: 10;
        }
        .recording-interface.is-live {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            height: 350px;
            z-index: 1000;
            background-color: var(--glass-recording-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid var(--glass-recording-border);
            box-shadow: 0 -4px 20px var(--glass-shadow);
            justify-content: flex-start;
            padding: 20px;
        }
        .live-recording-title, #liveWaveformCanvas, .live-recording-timer {
            opacity: 0;
            transform: translateY(15px);
            transition: opacity 0.3s ease-out 0.1s, transform 0.35s ease-out 0.1s;
        }
        .recording-interface.is-live .live-recording-title,
        .recording-interface.is-live #liveWaveformCanvas,
        .recording-interface.is-live .live-recording-timer {
            opacity: 1;
            transform: translateY(0);
        }
        #liveWaveformCanvas { width: 100%; max-width: 340px; height: 70px; margin-bottom: 18px; border-radius: 4px; }
        .live-recording-timer { font-family: var(--font-mono); font-size: 44px; font-weight: 400; margin-bottom: 22px; text-align: center; }
        
        .record-button { position: relative; width: 72px; height: 72px; border-radius: 50%; border: none; outline: none; background: none; cursor: pointer; z-index: 1; }
        .record-button-inner { position: relative; width: 100%; height: 100%; border-radius: 50%; background: var(--glass-bg); border: 1px solid var(--glass-border); display: flex; align-items: center; justify-content: center; color: #111827; font-size: 24px; z-index: 2; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s ease; backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); }
        .record-button:hover .record-button-inner { transform: scale(1.08); }
        .record-button.recording .record-button-inner { background-color: var(--color-recording); border-color: transparent; color: white; }

        @keyframes wave { 0% { transform: scale(0.4); opacity: 0.8; } 100% { transform: scale(1.8); opacity: 0; } }
        .record-waves { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 200px; height: 200px; z-index: 1; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; }
        .record-button.recording .record-waves { opacity: 1; }
        .wave { fill: none; stroke: var(--color-recording); stroke-width: 1.5px; opacity: 0; transform-origin: center; }
        .record-button.recording .wave1 { animation: wave 2s infinite ease-out; }
        .record-button.recording .wave2 { animation: wave 2s infinite ease-out 0.4s; }
        
        .notion-block {
            border-left: 3px solid var(--accent);
            padding-left: 1rem;
            margin-top: 0.5rem;
        }
        
        /* Modal Styles */
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        
        /* Playbook Category Filter */
        .playbook-category-btn { transition: all 0.2s ease; border: 1px solid #e5e7eb; }
        .playbook-category-btn.active, .playbook-category-btn:hover {
            background-color: var(--accent);
            color: white;
            border-color: var(--accent);
        }
    </style>
     <script type="importmap">
      {
        "imports": {
          "@google/genai": "https://esm.sh/@google/genai@^0.8.0",
          "marked": "https://esm.sh/marked@^4.0.0"
        }
      }
    </script>
</head>
<body class="text-gray-900 overflow-x-hidden">

    <div class="relative min-h-screen md:flex">
        <!-- Mobile Header -->
        <div class="md:hidden flex justify-between items-center bg-white border-b border-gray-200 p-4 sticky top-0 z-40">
            <a href="#" class="font-bold text-sm tracking-wider">Operalta</a>
            <button id="mobile-menu-btn">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
        </div>

        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="w-64 flex-shrink-0 bg-white border-r border-gray-200 flex flex-col fixed inset-y-0 left-0 z-50 transform -translate-x-full md:relative md:translate-x-0">
            <div class="h-16 flex items-center px-6 border-b border-gray-200">
                <a href="#" class="font-bold text-sm tracking-wider flex items-center gap-2"><span>Operalta</span></a>
            </div>
            
            <nav id="ceo-nav" class="flex-1 px-4 py-6 space-y-2">
                <a href="#" id="nav-dashboard" class="sidebar-link active flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>Dashboard</a>
                <a href="#" id="nav-reports" class="sidebar-link flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>Reports</a>
                <a href="#" id="nav-playbooks" class="sidebar-link flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v11.494m-9-5.747h18"></path></svg>Playbooks</a>
                <a href="#" id="nav-integrations" class="sidebar-link flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>Integrations</a>
                <a href="#" id="nav-settings" class="sidebar-link flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>Settings</a>
            </nav>
            <nav id="vc-nav" class="hidden flex-1 px-4 py-6 space-y-2">
                <a href="#" id="nav-vc-dashboard" class="sidebar-link active flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2a4 4 0 00-4-4H3s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1h-2a4 4 0 00-4 4v2"></path><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"></path><path d="M17.63 17.63A4 4 0 1014 14a4 4 0 003.63 3.63z"></path></svg>Portfolio</a>
                <a href="#" id="nav-vc-playbooks" class="sidebar-link flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v11.494m-9-5.747h18"></path></svg>Playbooks</a>
                 <a href="#" id="nav-vc-settings" class="sidebar-link flex items-center px-4 py-2 text-sm text-gray-600 rounded-md"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>Settings</a>
            </nav>
            
             <div class="px-4 py-4 mt-auto border-t border-gray-200">
                <div class="flex items-center mb-4">
                    <img id="user-avatar" class="h-8 w-8 rounded-full object-cover" src="https://placehold.co/100x100/5B21B6/FFFFFF?text=A" alt="User Avatar">
                    <div class="ml-3">
                        <p id="user-name" class="text-sm font-semibold text-gray-800">Alex (CEO)</p>
                        <p id="user-company" class="text-xs text-gray-500">Acme Inc.</p>
                    </div>
                </div>
                 <div class="mt-4 text-xs mono">
                    <label for="view-toggle" class="flex items-center cursor-pointer">
                        <span id="ceo-label" class="mr-2 font-semibold text-purple-700">CEO</span>
                        <div class="relative">
                            <input type="checkbox" id="view-toggle" class="sr-only">
                            <div class="toggle-bg block bg-gray-200 w-10 h-5 rounded-full"></div>
                            <div class="toggle-dot absolute left-0 top-0 bg-white w-5 h-5 rounded-full shadow-md"></div>
                        </div>
                        <span id="vc-label" class="ml-2 text-gray-500">VC</span>
                    </label>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1">
            <div id="ceo-view">
                <div id="page-dashboard" class="p-4 sm:p-8 md:p-12 baseline-grid">
                    <div id="api-key-banner" class="hidden bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6 rounded-r-lg" role="alert">
                        <p class="font-bold">Action Required</p>
                        <p>Please <a href="#" id="banner-settings-link" class="underline font-semibold">add your Gemini API key</a> in the settings to enable recording.</p>
                    </div>
                    <header class="mb-8"><h1 class="text-2xl sm:text-3xl font-bold tracking-tight">CEO Dashboard</h1><p class="text-gray-500 mt-1 mono text-sm">Welcome back, Alex. Your augmented co-founder is ready.</p></header><div class="bg-white p-6 sm:p-8 border border-gray-200 rounded-lg shadow-sm mb-8"><div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4"><h2 class="text-lg font-bold">Create Weekly Update</h2><span class="text-xs mono text-gray-500 mt-1 sm:mt-0">Voice Memo → AI Synthesis → Investor Report</span></div><div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 sm:gap-6"><button id="start-recording-btn" class="w-16 h-16 bg-purple-700 text-white rounded-full flex items-center justify-center hover:bg-purple-800 transition-all transform hover:scale-105 shadow-lg flex-shrink-0"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg></button><div class="flex-1"><p class="font-semibold">Record a 5-minute voice memo</p><p class="text-sm text-gray-600">Summarize your week: wins, challenges, and key metrics. Our AI will do the rest.</p></div></div></div>
                     <div class="bg-white p-6 sm:p-8 border border-gray-200 rounded-lg shadow-sm">
                        <h2 class="text-lg font-bold mb-4">Recent Activity</h2>
                        <div class="text-sm text-gray-500">No recent reports. Record an update to get started.</div>
                    </div>
                </div>
                
                <div id="page-recording" class="hidden p-4 sm:p-8 md:p-12">
                    <header class="mb-8"><h1 class="text-2xl sm:text-3xl font-bold tracking-tight">New Weekly Update</h1></header>
                    <div id="processing-state" class="hidden text-center py-16"><div class="inline-block w-8 h-8 border-2 border-purple-700 border-t-transparent rounded-full animate-spin mb-4"></div><h3 id="processing-status" class="font-bold">Processing audio...</h3><p class="text-sm text-gray-600 mt-2">This usually takes less than a minute.</p></div>
                    <div id="completed-state" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-12">
                        <!-- AI Analysis -->
                        <div id="extracted-intelligence">
                             <h4 class="font-bold text-sm mb-4">Extracted Intelligence</h4>
                             <div class="bg-white p-6 border border-gray-200 rounded-lg space-y-4">
                                <!-- Content injected here -->
                             </div>
                        </div>
                        <!-- Strategic Update -->
                        <div id="strategic-update">
                            <h4 class="font-bold text-sm mb-4">Strategic Update</h4>
                            <div class="bg-white border-2 border-gray-200 p-6 rounded-lg shadow-lg">
                                <!-- Content injected here -->
                            </div>
                        </div>
                    </div>
                </div>

                <div id="page-reports" class="hidden p-4 sm:p-8 md:p-12">
                    <header class="mb-8 flex justify-between items-center">
                        <div>
                            <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Reports</h1>
                            <p class="text-gray-500 mt-1 mono text-sm">History of all generated investor updates.</p>
                        </div>
                        <button id="new-report-btn" class="bg-purple-700 text-white px-4 py-2 text-sm font-bold hover:bg-purple-800 transition-colors rounded-md">New Report</button>
                    </header>
                    <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50"><tr class="text-left text-xs text-gray-500 uppercase tracking-wider"><th class="p-4 font-semibold">Date</th><th class="p-4 font-semibold">Title</th><th class="p-4 font-semibold">Status</th><th class="p-4 font-semibold hidden md:table-cell">Key Metric</th><th class="p-4"></th></tr></thead>
                            <tbody class="divide-y divide-gray-200">
                                <!-- Rows will be injected by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="page-playbooks" class="hidden p-4 sm:p-8 md:p-12">
                    <header class="mb-8 flex justify-between items-baseline">
                         <div>
                            <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Playbook Library</h1>
                            <p class="text-gray-500 mt-1 mono text-sm">1,247+ proven strategies from top-tier companies.</p>
                        </div>
                    </header>
                    <div id="playbook-category-filters" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 text-center mb-12">
                         <div class="playbook-category-btn aspect-square flex flex-col items-center justify-center cursor-pointer p-2 rounded-md" data-category="Growth"><span class="text-2xl mb-1">⬆</span><span class="text-xs font-bold">GROWTH</span></div>
                         <div class="playbook-category-btn aspect-square flex flex-col items-center justify-center cursor-pointer p-2 rounded-md" data-category="Hiring"><span class="text-2xl mb-1">◐</span><span class="text-xs font-bold">HIRING</span></div>
                         <div class="playbook-category-btn aspect-square flex flex-col items-center justify-center cursor-pointer p-2 rounded-md" data-category="Fundraising"><span class="text-2xl mb-1">◈</span><span class="text-xs font-bold">FUNDRAISING</span></div>
                         <div class="playbook-category-btn aspect-square flex flex-col items-center justify-center cursor-pointer p-2 rounded-md" data-category="Product"><span class="text-2xl mb-1">◉</span><span class="text-xs font-bold">PRODUCT</span></div>
                         <div class="playbook-category-btn aspect-square flex flex-col items-center justify-center cursor-pointer p-2 rounded-md" data-category="Sales"><span class="text-2xl mb-1">▣</span><span class="text-xs font-bold">SALES</span></div>
                         <div class="playbook-category-btn aspect-square flex flex-col items-center justify-center cursor-pointer p-2 rounded-md" data-category="Legal"><span class="text-2xl mb-1">◊</span><span class="text-xs font-bold">LEGAL</span></div>
                    </div>
                     <div id="ceo-playbook-list" class="space-y-8">
                        <!-- Playbook content will be injected here by JS -->
                    </div>
                </div>

                <div id="page-integrations" class="hidden p-4 sm:p-8 md:p-12">
                     <header class="mb-8"><h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Integrations</h1><p class="text-gray-500 mt-1 mono text-sm">Connect Operalta to your existing workflow.</p></header>
                     <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="bg-white border border-gray-200 rounded-lg p-6 flex flex-col"><div class="flex items-center mb-4"><img src="https://placehold.co/40x40/000000/FFFFFF?text=N" class="w-10 h-10 mr-4"><h3 class="text-lg font-bold">Notion</h3></div><p class="text-sm text-gray-600 flex-1 mb-4">Sync your company wiki, roadmaps, and KPIs to provide context for AI analysis.</p><button class="w-full bg-green-500 text-white py-2 text-sm font-bold rounded-md">Connected</button></div>
                        <div class="bg-white border border-gray-200 rounded-lg p-6 flex flex-col"><div class="flex items-center mb-4"><img src="https://placehold.co/40x40/4A154B/FFFFFF?text=S" class="w-10 h-10 mr-4"><h3 class="text-lg font-bold">Slack</h3></div><p class="text-sm text-gray-600 flex-1 mb-4">Send report summaries and get notifications directly in your team's channels.</p><button class="w-full bg-gray-200 text-gray-800 py-2 text-sm font-bold hover:bg-gray-300 rounded-md">Connect</button></div>
                        <div class="bg-white border border-gray-200 rounded-lg p-6 flex flex-col"><div class="flex items-center mb-4"><img src="https://placehold.co/40x40/635BFF/FFFFFF?text=S" class="w-10 h-10 mr-4"><h3 class="text-lg font-bold">Stripe</h3></div><p class="text-sm text-gray-600 flex-1 mb-4">Automatically pull in key financial metrics like ARR, MRR, and growth rates.</p><button class="w-full bg-gray-200 text-gray-800 py-2 text-sm font-bold hover:bg-gray-300 rounded-md">Connect</button></div>
                     </div>
                </div>
                
                <div id="page-settings" class="hidden p-4 sm:p-8 md:p-12">
                    <header class="mb-8"><h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Settings</h1></header>
                    <div class="bg-white p-6 sm:p-8 border border-gray-200 rounded-lg shadow-sm max-w-2xl">
                        <h2 class="text-lg font-bold mb-1">API Configuration</h2>
                        <p class="text-sm text-gray-600 mb-4">A valid Google Gemini API key is required for audio transcription and analysis.</p>
                        <div class="space-y-2">
                            <label for="api-key-input" class="text-sm font-semibold text-gray-700">Gemini API Key</label>
                            <input type="password" id="api-key-input" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm" placeholder="Enter your API key">
                        </div>
                        <div class="mt-4 flex items-center justify-between">
                            <button id="save-api-key-btn" class="bg-purple-700 text-white px-4 py-2 text-sm font-bold hover:bg-purple-800 transition-colors rounded-md">Save Key</button>
                            <span id="api-key-status" class="text-sm text-green-600"></span>
                        </div>
                        <p class="text-xs text-gray-500 mt-4">You can get a key from <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-purple-700 underline">Google AI Studio</a>. Your key is stored securely in your browser's local storage.</p>
                    </div>
                </div>
            </div>

            <div id="vc-view" class="hidden">
                 <div id="page-vc-dashboard" class="p-4 sm:p-8 md:p-12">
                    <header class="mb-8">
                        <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Portfolio Dashboard</h1>
                        <p class="text-gray-500 mt-1 mono text-sm">High-level intelligence on your investments.</p>
                    </header>

                    <div class="mb-8 bg-white border border-gray-200 rounded-lg p-6">
                        <h2 class="font-bold mb-4">Portfolio Health Overview</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                            <div><p class="text-3xl font-bold text-green-600">8</p><p class="text-sm text-gray-500">On Track</p></div>
                            <div><p class="text-3xl font-bold text-yellow-500">2</p><p class="text-sm text-gray-500">Needs Attention</p></div>
                            <div><p class="text-3xl font-bold text-red-600">0</p><p class="text-sm text-gray-500">At Risk</p></div>
                        </div>
                    </div>
                    
                    <div class="mb-8 bg-white border border-gray-200 rounded-lg p-6">
                        <h2 class="font-bold mb-4">AI-Generated Cross-Portfolio Insights</h2>
                        <ul class="space-y-3 text-sm">
                            <li class="flex items-start gap-3"><span class="text-purple-600 mt-1">◈</span><span><strong>Positive Trend:</strong> 5 companies mentioned successful enterprise pilots this week, suggesting strong Q4 pipeline.</span></li>
                            <li class="flex items-start gap-3"><span class="text-yellow-600 mt-1">!</span><span><strong>Potential Risk:</strong> 3 companies in the B2C space noted rising customer acquisition costs (CAC). <a href="#" class="text-purple-700 underline">Suggest "Growth Hacking" playbook</a>.</span></li>
                            <li class="flex items-start gap-3"><span class="text-blue-600 mt-1">→</span><span><strong>Opportunity:</strong> Innovate Inc. and Synergy AI are both hiring for senior product roles. Consider an introduction between their VPs of Product to share best practices.</span></li>
                        </ul>
                    </div>

                    <div id="vc-portfolio-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Portfolio companies injected by JS -->
                    </div>
                </div>
                 <div id="page-vc-playbooks" class="hidden p-4 sm:p-8 md:p-12">
                     <header class="mb-8 flex justify-between items-baseline">
                         <div>
                            <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Firm Playbooks</h1>
                            <p class="text-gray-500 mt-1 mono text-sm">Proprietary strategies for your portfolio companies.</p>
                        </div>
                        <button id="author-playbook-btn" class="bg-purple-700 text-white px-4 py-2 text-sm font-bold hover:bg-purple-800 transition-colors rounded-md">Author New Playbook</button>
                    </header>
                    <div class="mb-8">
                        <h2 class="font-bold mb-4">Atomic Ventures' Custom Playbooks</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white border border-gray-200 p-6 rounded-lg playbook-link cursor-pointer hover:shadow-md" data-playbook-id="board-meetings"><h3 class="font-bold mb-2">Our Guide to Board Meetings</h3><p class="text-sm text-gray-600">The essential template and best practices for running an effective board meeting.</p></div>
                            <div class="bg-white border border-gray-200 p-6 rounded-lg playbook-link cursor-pointer hover:shadow-md" data-playbook-id="term-sheet"><h3 class="font-bold mb-2">Term Sheet Negotiation 101</h3><p class="text-sm text-gray-600">Key terms and strategies for a successful fundraise.</p></div>
                        </div>
                    </div>
                     <div>
                        <h2 class="font-bold mb-4">Playbooks Popular in Your Portfolio</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white border border-gray-200 p-6 rounded-lg playbook-link cursor-pointer hover:shadow-md" data-playbook-id="eng-hiring"><h3 class="font-bold mb-2">Scaling Engineering Teams</h3><p class="text-sm text-gray-600">From 10 to 100 engineers. The definitive guide by Revolut.</p></div>
                            <div class="bg-white border border-gray-200 p-6 rounded-lg playbook-link cursor-pointer hover:shadow-md" data-playbook-id="seed-deck"><h3 class="font-bold mb-2">The Perfect Seed Deck</h3><p class="text-sm text-gray-600">As recommended by Y Combinator for all their early-stage founders.</p></div>
                        </div>
                    </div>
                 </div>
                 <div id="page-vc-settings" class="hidden p-4 sm:p-8 md:p-12">
                      <header class="mb-8"><h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Settings</h1></header>
                      <p>VC settings page placeholder.</p>
                 </div>
            </div>
        </main>
        
        <div id="recording-interface" class="recording-interface hidden flex-col items-center">
            <div id="liveRecordingTitle" class="live-recording-title hidden text-lg font-semibold">New Recording</div>
            <canvas id="liveWaveformCanvas" class="hidden"></canvas>
            <div id="liveRecordingTimerDisplay" class="live-recording-timer hidden">00:00.00</div>
            <div id="recording-status-text" class="status-text text-gray-500 mb-4">Ready to record</div>
            <div class="recording-controls">
                <button id="recordButton" class="record-button" title="Start Recording"><div class="record-button-inner"><i class="fas fa-microphone"></i></div><svg class="record-waves" viewBox="0 0 200 200"><circle class="wave wave1" cx="100" cy="100" r="40" /><circle class="wave wave2" cx="100" cy="100" r="70" /></svg></button>
            </div>
        </div>

        <!-- Generic Modal -->
        <div id="modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div id="modal-overlay" class="absolute inset-0"></div>
            <div id="modal-content" class="modal-content bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto relative transform scale-95 opacity-0">
                <div class="p-6">
                    <div class="flex justify-between items-center pb-4 border-b border-gray-200">
                        <h2 id="modal-title" class="text-xl font-bold">Modal Title</h2>
                        <button id="modal-close-btn" class="text-gray-400 hover:text-gray-600 text-3xl leading-none">&times;</button>
                    </div>
                    <div id="modal-body" class="py-6">
                        <!-- Modal content goes here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { GoogleGenAI } from "@google/genai";
        import { marked } from "marked";

        const MODEL_NAME = 'gemini-1.5-flash';

        // --- DEBUGGED DictationService CLASS ---
        class DictationService {
            constructor(options) {
                this.genAI = null;
                this.apiKey = options.apiKey;
                this.jsonModel = null;
                this.textModel = null;
                
                if (this.apiKey) {
                    try {
                        // FIX: Pass API key inside a configuration object
                        this.genAI = new GoogleGenAI({ apiKey: this.apiKey });
                        // FIX: Initialize models using getGenerativeModel
                        this.textModel = this.genAI.getGenerativeModel({ model: MODEL_NAME });
                        this.jsonModel = this.genAI.getGenerativeModel({
                            model: MODEL_NAME,
                            generationConfig: { responseMimeType: "application/json" },
                        });
                    } catch (e) {
                        console.error("Failed to initialize GoogleGenAI:", e);
                    }
                }
                
                this.recordButton = options.recordButton;
                this.statusTextElement = options.statusTextElement;
                this.onProcessingComplete = options.onProcessingComplete;
                this.onRecordingStart = options.onRecordingStart;
                this.onRecordingStop = options.onRecordingStop;
                
                this.liveWaveformCanvas = document.getElementById('liveWaveformCanvas');
                this.liveRecordingTimerDisplay = document.getElementById('liveRecordingTimerDisplay');
                this.recordingInterface = document.getElementById('recording-interface');
                this.liveRecordingTitle = document.getElementById('liveRecordingTitle');

                if (this.liveWaveformCanvas) {
                    this.liveWaveformCtx = this.liveWaveformCanvas.getContext('2d');
                }
                
                this.audioChunks = [];
                this.isRecording = false;
                this.mediaRecorder = null;
                this.stream = null;
                this.audioContext = null;

                this.bindEventListeners();
            }
            
            isReady() {
                return this.genAI !== null && this.jsonModel !== null && this.textModel !== null;
            }

            bindEventListeners() {
                this.recordButton.addEventListener('click', () => this.toggleRecording());
                window.addEventListener('resize', () => this.handleResize());
            }
            
            handleResize() { if (this.isRecording) requestAnimationFrame(() => this.setupCanvasDimensions()); }

            setupCanvasDimensions() {
                if (!this.liveWaveformCanvas || !this.liveWaveformCtx) return;
                const canvas = this.liveWaveformCanvas;
                const dpr = window.devicePixelRatio || 1;
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
                this.liveWaveformCtx.setTransform(dpr, 0, 0, dpr, 0, 0);
            }

            async toggleRecording() {
                if (!this.isReady()) {
                    console.error("Dictation service not ready. API Key might be missing or invalid.");
                    this.statusTextElement.textContent = 'API Key invalid.';
                    this.statusTextElement.style.color = 'red';
                    return;
                }
                this.isRecording ? await this.stopRecording() : await this.startRecording();
            }
            
            async startRecording() {
                try {
                    this.audioChunks = [];
                    this.statusTextElement.textContent = 'Requesting microphone...';
                    this.stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    this.mediaRecorder = new MediaRecorder(this.stream);
                    this.mediaRecorder.ondataavailable = e => { if (e.data.size > 0) this.audioChunks.push(e.data) };
                    this.mediaRecorder.onstop = () => {
                        if (this.onRecordingStop) this.onRecordingStop();
                        this.stopLiveDisplay();
                        if (this.audioChunks.length > 0) {
                            const audioBlob = new Blob(this.audioChunks, { type: this.mediaRecorder?.mimeType || 'audio/webm' });
                            this.processAudio(audioBlob);
                        }
                        if (this.stream) this.stream.getTracks().forEach(track => track.stop());
                    };

                    this.mediaRecorder.start();
                    this.isRecording = true;
                    this.recordButton.classList.add('recording');
                    this.recordButton.title = 'Stop Recording';
                    this.startLiveDisplay();
                    if(this.onRecordingStart) this.onRecordingStart();

                } catch (error) {
                    console.error("Error starting recording:", error);
                    this.statusTextElement.textContent = 'Microphone access denied.';
                }
            }
            
            async stopRecording() {
                if (this.mediaRecorder && this.isRecording) {
                    this.mediaRecorder.stop();
                    this.isRecording = false;
                    this.recordButton.classList.remove('recording');
                    this.recordButton.title = 'Start Recording';
                    this.statusTextElement.textContent = 'Processing...';
                }
            }
            
            startLiveDisplay() {
                this.recordingInterface.classList.add('is-live');
                ['liveRecordingTitle', 'liveWaveformCanvas', 'liveRecordingTimerDisplay'].forEach(id => document.getElementById(id)?.classList.remove('hidden'));
                this.setupCanvasDimensions();
                const icon = this.recordButton.querySelector('i');
                if(icon) { icon.classList.remove('fa-microphone'); icon.classList.add('fa-stop'); }
                this.setupAudioVisualizer();
                this.drawLiveWaveform();
                this.recordingStartTime = Date.now();
                if (this.timerIntervalId) clearInterval(this.timerIntervalId);
                this.timerIntervalId = setInterval(() => this.updateLiveTimer(), 50);
            }

            stopLiveDisplay() {
                 this.recordingInterface.classList.remove('is-live');
                 setTimeout(() => this.recordingInterface.classList.add('hidden'), 500);
                ['liveRecordingTitle', 'liveWaveformCanvas', 'liveRecordingTimerDisplay'].forEach(id => document.getElementById(id)?.classList.add('hidden'));
                const icon = this.recordButton.querySelector('i');
                if(icon) { icon.classList.remove('fa-stop'); icon.classList.add('fa-microphone'); }
                if (this.waveformDrawingId) cancelAnimationFrame(this.waveformDrawingId);
                if (this.timerIntervalId) clearInterval(this.timerIntervalId);
                if (this.audioContext && this.audioContext.state !== 'closed') this.audioContext.close();
                this.audioContext = null;
            }

            setupAudioVisualizer() {
                if (!this.stream) return;
                this.audioContext = new AudioContext();
                const source = this.audioContext.createMediaStreamSource(this.stream);
                this.analyserNode = this.audioContext.createAnalyser();
                this.analyserNode.fftSize = 256;
                this.waveformDataArray = new Uint8Array(this.analyserNode.frequencyBinCount);
                source.connect(this.analyserNode);
            }

            drawLiveWaveform() {
                if (!this.isRecording) return;
                requestAnimationFrame(() => this.drawLiveWaveform());
                if (!this.analyserNode) return;
                this.analyserNode.getByteFrequencyData(this.waveformDataArray);
                const ctx = this.liveWaveformCtx, canvas = this.liveWaveformCanvas;
                if(!ctx || !canvas) return;
                ctx.clearRect(0, 0, canvas.clientWidth, canvas.clientHeight);
                const numBars = this.waveformDataArray.length * 0.5;
                const barWidth = canvas.clientWidth / numBars * 0.7;
                let x = 0;
                ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--color-recording').trim();
                for (let i = 0; i < numBars; i++) {
                    const barHeight = (this.waveformDataArray[i] / 255) * canvas.clientHeight;
                    ctx.fillRect(x, (canvas.clientHeight - barHeight) / 2, barWidth, barHeight);
                    x += barWidth * 1.3;
                }
            }
            
            updateLiveTimer() {
                const elapsedMs = Date.now() - this.recordingStartTime;
                const minutes = Math.floor(elapsedMs / 60000);
                const seconds = Math.floor((elapsedMs % 60000) / 1000);
                const hundredths = Math.floor((elapsedMs % 1000) / 10);
                this.liveRecordingTimerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(hundredths).padStart(2, '0')}`;
            }

            async processAudio(audioBlob) {
                const base64Audio = await new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result.split(',')[1]);
                    reader.onerror = reject;
                    reader.readAsDataURL(audioBlob);
                });

                const audioPart = {
                    inlineData: {
                        mimeType: audioBlob.type,
                        data: base64Audio
                    }
                };
                
                await this.getTranscription(audioPart);
            }

            async getTranscription(audioPart) {
                try {
                    const prompt = 'Please provide a verbatim transcript of this audio recording.';
                    // FIX: Call generateContent on the model instance, and pass parts array
                    const result = await this.textModel.generateContent([prompt, audioPart]);
                    const transcription = result.response.text();
                    this.getPolishedNote(transcription);
                } catch (error) { 
                    console.error("Error during transcription:", error);
                    this.onProcessingComplete(null, null, { error: `Transcription failed: ${error.message}` }); 
                }
            }

            async getPolishedNote(rawTranscription) {
                 try {
                    if (!rawTranscription.trim()) { 
                        this.onProcessingComplete(null, rawTranscription, { arr: 'N/A', growth: 'N/A', runway: 'N/A' });
                        return;
                    }
                    
                    const prompt = `Analyze the following raw transcript of a CEO's weekly update and extract key information. Here is the transcript: --- ${rawTranscription} ---`;

                    // FIX: Call generateContent on the jsonModel instance
                    const result = await this.jsonModel.generateContent(prompt);
                    const responseText = result.response.text();
                    const data = JSON.parse(responseText);
                    this.onProcessingComplete(data, rawTranscription, null);

                } catch (error) { 
                    console.error("Error during polishing:", error);
                    this.onProcessingComplete(null, rawTranscription, { error: `AI analysis failed: ${error.message}` });
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            let dictationService = null;
            let currentView = 'ceo';
            let latestGeneratedReport = {};
            let activePlaybookCategories = [];

            const ui = {
                sidebar: document.getElementById('sidebar'),
                mobileMenuBtn: document.getElementById('mobile-menu-btn'),
                ceoView: document.getElementById('ceo-view'),
                vcView: document.getElementById('vc-view'),
                ceoNav: document.getElementById('ceo-nav'),
                vcNav: document.getElementById('vc-nav'),
                ceoPlaybookList: document.getElementById('ceo-playbook-list'),
                playbookCategoryFilters: document.getElementById('playbook-category-filters'),
                vcPortfolioList: document.getElementById('vc-portfolio-list'),
                reportsTableBody: document.querySelector('#page-reports tbody'),

                pages: {
                     dashboard: document.getElementById('page-dashboard'), recording: document.getElementById('page-recording'), reports: document.getElementById('page-reports'), playbooks: document.getElementById('page-playbooks'), integrations: document.getElementById('page-integrations'), settings: document.getElementById('page-settings'),
                     vcDashboard: document.getElementById('page-vc-dashboard'), vcPlaybooks: document.getElementById('page-vc-playbooks'), vcSettings: document.getElementById('page-vc-settings'),
                },
                navLinks: { 
                    ceo: { dashboard: document.getElementById('nav-dashboard'), reports: document.getElementById('nav-reports'), playbooks: document.getElementById('nav-playbooks'), integrations: document.getElementById('nav-integrations'), settings: document.getElementById('nav-settings') },
                    vc: { dashboard: document.getElementById('nav-vc-dashboard'), playbooks: document.getElementById('nav-vc-playbooks'), settings: document.getElementById('nav-vc-settings'), }
                },
                startRecordingBtn: document.getElementById('start-recording-btn'), newReportBtn: document.getElementById('new-report-btn'), recordButton: document.getElementById('recordButton'),
                recordingInterface: document.getElementById('recording-interface'), processingState: document.getElementById('processing-state'), processingStatus: document.getElementById('processing-status'), completedState: document.getElementById('completed-state'),
                
                extractedIntelligenceContainer: document.getElementById('extracted-intelligence'),
                strategicUpdateContainer: document.getElementById('strategic-update'),

                authorPlaybookBtn: document.getElementById('author-playbook-btn'),

                apiKeyBanner: document.getElementById('api-key-banner'), bannerSettingsLink: document.getElementById('banner-settings-link'), apiKeyInput: document.getElementById('api-key-input'),
                saveApiKeyBtn: document.getElementById('save-api-key-btn'), apiKeyStatus: document.getElementById('api-key-status'),
                viewToggle: document.getElementById('view-toggle'), userName: document.getElementById('user-name'), userCompany: document.getElementById('user-company'), userAvatar: document.getElementById('user-avatar'),
                ceoLabel: document.getElementById('ceo-label'), vcLabel: document.getElementById('vc-label'),

                modal: document.getElementById('modal'), modalOverlay: document.getElementById('modal-overlay'), modalContent: document.getElementById('modal-content'),
                modalTitle: document.getElementById('modal-title'), modalBody: document.getElementById('modal-body'), modalCloseBtn: document.getElementById('modal-close-btn'),
            };

            let db = {
                companies: {
                    innovate: { name: 'Innovate Inc.', status: 'On Track', metrics: { arr: '€2.1M', growth: '+18%', runway: '24mo' } },
                    quantum: { name: 'QuantumLeap', status: 'Needs Attention', metrics: { arr: '€800K', growth: '-5%', runway: '9mo' } },
                    synergy: { name: 'Synergy AI', status: 'On Track', metrics: { arr: '€4.5M', growth: '+25%', runway: '16mo' } },
                    dataforge: { name: 'DataForge', status: 'On Track', metrics: { arr: '€1.5M', growth: '+12%', runway: '20mo' } },
                    nextech: { name: 'NexTech', status: 'On Track', metrics: { arr: '€3.2M', growth: '+15%', runway: '18mo' } },
                    cloudscape: { name: 'Cloudscape', status: 'Needs Attention', metrics: { arr: '€950K', growth: '+2%', runway: '11mo' } },
                    biogen: { name: 'BioGen', status: 'On Track', metrics: { arr: '€1.8M', growth: '+20%', runway: '22mo' } },
                    finwise: { name: 'FinWise', status: 'On Track', metrics: { arr: '€5.1M', growth: '+19%', runway: '15mo' } },
                    logix: { name: 'Logix', status: 'On Track', metrics: { arr: '€2.8M', growth: '+14%', runway: '19mo' } },
                    zenith: { name: 'Zenith VR', status: 'On Track', metrics: { arr: '€1.1M', growth: '+30%', runway: '14mo' } },
                },
                reports: {},
                playbooks: {
                    'plg': { category: 'Growth', title: 'Product-Led Growth Engine', company: 'SLACK', content: '<h3>Key Idea</h3><p>Focus on making the product itself the primary driver of user acquisition, conversion, and expansion.</p><ul><li>Freemium model to reduce friction.</li><li>Seamless user onboarding.</li><li>Built-in virality (e.g., inviting colleagues).</li></ul>' },
                    'outbound': { category: 'Growth', title: 'Outbound Sales Cadence', company: 'HUBSPOT', content: '<h3>Key Idea</h3><p>A structured sequence of touchpoints (email, call, social) to engage prospects.</p><ol><li>Day 1: Personalized Email</li><li>Day 3: LinkedIn Connection Request</li><li>Day 5: Follow-up Email + Call</li></ol>' },
                    'eng-hiring': { category: 'Hiring', title: 'Scaling Engineering Teams', company: 'REVOLUT', content: `<h3>Key Principles</h3><ul><li><strong>Hire for Slope, Not Just Experience:</strong> Look for candidates with a steep learning curve and high potential, not just years on a resume.</li><li><strong>Bar Raiser Interviews:</strong> Involve a senior engineer from a different team in the final interview loop to maintain a consistently high bar for talent.</li><li><strong>Practical Problem Solving:</strong> Use a take-home project or a pair-programming session that mirrors real-world work.</li></ul>` },
                    'remote': { category: 'Hiring', title: 'Remote Transformation', company: 'GITLAB', content: '<h3>Key Idea</h3><p>Build a thriving, productive company with no physical offices.</p><ul><li>Document everything in a central handbook.</li><li>Promote asynchronous communication.</li><li>Invest in tools for remote collaboration.</li></ul>' },
                    'seed-deck': { category: 'Fundraising', title: 'The Perfect Seed Deck', company: 'Y COMBINATOR', content: `<h3>The 10-Slide Structure</h3><ol><li>Title</li><li>Problem</li><li>Solution</li><li>Market Size</li><li>Product</li><li>Traction</li><li>Team</li><li>Competition</li><li>Business Model</li><li>The Ask</li></ol>` },
                    'board-meeting': { category: 'Fundraising', title: 'Board Meeting Excellence', company: 'SPOTIFY', content: '<h3>Key Idea</h3><p>Structure board meetings around strategic decisions, not just updates.</p><ul><li>Send materials 48 hours in advance.</li><li>Focus 80% of time on forward-looking strategy.</li><li>Use a data-driven appendix for metrics.</li></ul>' },
                    'product-docs': { category: 'Product', title: 'Writing Great Product Docs', company: 'INTERCOM', content: '<h3>Key Idea</h3><p>Structure product docs around the "Why, What, and How" to ensure clarity for the entire team.</p><ul><li><strong>Why:</strong> The problem you are solving and for whom.</li><li><strong>What:</strong> The scope of the feature, including user stories and success metrics.</li><li><strong>How:</strong> High-level technical approach and design mocks.</li></ul>' },
                    'user-interviews': { category: 'Product', title: 'Effective User Interviews', company: 'STRIPE', content: '<h3>Key Idea</h3><p>Ask open-ended questions about past behavior, not future intentions. Focus on understanding their problems deeply rather than pitching your solution.</p>' },
                    'enterprise-sales': { category: 'Sales', title: 'Enterprise Sales Playbook', company: 'SALESFORCE', content: '<h3>Key Idea</h3><p>Navigate complex sales cycles by mapping the organization, identifying the champion, economic buyer, and technical buyer, and building consensus across the buying committee.</p>' },
                    'saas-pricing': { category: 'Sales', title: 'Value-Based SaaS Pricing', company: 'TWILIO', content: '<h3>Key Idea</h3><p>Price your product based on the value it delivers to the customer segment, not on your costs or competitor prices. Common models include per-user, usage-based, and tiered pricing.</p>' },
                    'cap-table': { category: 'Legal', title: 'Cap Table Management', company: 'CARTA', content: '<h3>Key Idea</h3><p>Maintain a clean and accurate capitalization table from day one. It is the single source of truth for company ownership and is critical for fundraising and employee equity.</p>' },
                    'nda': { category: 'Legal', title: 'When to Use an NDA', company: 'WILSON SONSINI', content: '<h3>Key Idea</h3><p>Use Non-Disclosure Agreements sparingly. They are standard for M&A or deep strategic partnerships, but create unnecessary friction when talking to most VCs or potential hires.</p>' },
                    'board-meetings': { title: "Our Guide to Board Meetings", content: "<h3>The Atomic Ventures Board Meeting Framework</h3><p>The essential template and best practices for running an effective board meeting that drives decisions, not just reporting.</p><ol><li><strong>Pre-Meeting:</strong> Send a concise pre-read 72 hours in advance, highlighting key decisions needed.</li><li><strong>Meeting Structure:</strong> 10% review of past performance, 60% strategic discussion on 2-3 key topics, 30% open discussion and administrative.</li><li><strong>Post-Meeting:</strong> Send minutes and action items within 24 hours.</li></ol>" },
                    'term-sheet': { title: "Term Sheet Negotiation 101", content: "<h3>Key Terms for Founders</h3><p>Key terms and strategies for a successful fundraise, focusing on founder-friendly outcomes.</p><ul><li><strong>Valuation:</strong> Understand pre-money vs. post-money.</li><li><strong>Liquidation Preference:</strong> Aim for 1x, non-participating.</li><li><strong>Board Composition:</strong> Ensure founder control or a balanced board.</li><li><strong>Vesting:</strong> Standard is 4-year vest with a 1-year cliff.</li></ul>" }
                }
            };

            function loadReports() {
                const savedReports = localStorage.getItem('operaltaReports');
                if (savedReports) {
                    db.reports = JSON.parse(savedReports);
                } else {
                    db.reports = {
                        w36_2025: { id: 'w36_2025', title: 'Weekly Update - W36', date: 'Sep 5, 2025', status: 'Sent', metrics: { arr: '€1.2M', growth: '+23%', runway: '18mo' }, content: marked.parse('### Wins\n* Strong month with 23% MoM growth.\n* Closed 3 enterprise deals totaling €240k in new ARR.\n### Challenges\n* Engineering hiring remains top priority.') },
                        w35_2025: { id: 'w35_2025', title: 'Weekly Update - W35', date: 'Aug 29, 2025', status: 'Sent', metrics: { arr: '€1.1M', growth: '+15%', runway: '19mo' }, content: marked.parse('### Wins\n* Onboarded 2 major enterprise clients: Globex Corp and Innovate LLC.\n* Successful launch of the new analytics dashboard.\n### Next Steps\n* Begin planning for Series A raise in Q1 2026.') },
                        w34_2025: { id: 'w34_2025', title: 'Weekly Update - W34', date: 'Aug 22, 2025', status: 'Draft', metrics: { arr: '€1.05M', growth: '+5%', runway: '20mo' }, content: marked.parse('### Challenges\n* Unexpected churn from a mid-market customer.\n* Technical debt is slowing down feature development.') },
                    };
                }
                renderReportsTable();
            }

            function saveReports() {
                localStorage.setItem('operaltaReports', JSON.stringify(db.reports));
            }

            function addNewReport(reportData) {
                const now = new Date();
                const weekNumber = now.getWeek();
                const reportId = `w${weekNumber}-${now.getTime()}`;

                const newReport = {
                    id: reportId,
                    title: `Weekly Update - W${weekNumber}`,
                    date: now.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
                    status: 'Draft',
                    metrics: {
                        arr: reportData.arr || 'N/A',
                        growth: reportData.growth || 'N/A',
                        runway: reportData.runway || 'N/A',
                    },
                    content: reportData.fullSummary ? marked.parse(reportData.fullSummary) : 'No summary available.'
                };

                db.reports[reportId] = newReport;
                saveReports();
                renderReportsTable();
            }

            function renderReportsTable() {
                if (!ui.reportsTableBody) return;
                ui.reportsTableBody.innerHTML = '';

                if (Object.keys(db.reports).length === 0) {
                     ui.reportsTableBody.innerHTML = `<tr><td colspan="5" class="text-center p-8 text-gray-500">No reports found.</td></tr>`;
                     return;
                }

                const sortedReports = Object.values(db.reports).sort((a, b) => new Date(b.date) - new Date(a.date));

                sortedReports.forEach(report => {
                    const statusClass = report.status === 'Sent' ? 'text-green-800 bg-green-100' : 'text-yellow-800 bg-yellow-100';
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="p-4">${report.date}</td>
                        <td class="p-4 font-semibold">${report.title}</td>
                        <td class="p-4"><span class="px-2 py-1 text-xs font-semibold ${statusClass} rounded-full">${report.status}</span></td>
                        <td class="p-4 hidden md:table-cell">${report.metrics.growth || 'N/A'}</td>
                        <td class="p-4 text-right"><a href="#" class="text-purple-700 hover:underline view-report-link" data-report-id="${report.id}">View</a></td>
                    `;
                    ui.reportsTableBody.appendChild(row);
                });

                document.querySelectorAll('.view-report-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        showViewReportModal(e.target.dataset.reportId);
                    });
                });
            }

            function showPage(pageName) {
                const pageMap = {
                    'dashboard': ui.pages.dashboard, 'recording': ui.pages.recording, 'reports': ui.pages.reports, 'playbooks': ui.pages.playbooks, 'integrations': ui.pages.integrations, 'settings': ui.pages.settings,
                    'vc-dashboard': ui.pages.vcDashboard, 'vc-playbooks': ui.pages.vcPlaybooks, 'vc-settings': ui.pages.vcSettings,
                };
                Object.values(pageMap).forEach(page => page?.classList.add('hidden'));
                pageMap[pageName]?.classList.remove('hidden');

                const navMap = currentView === 'ceo' ? ui.navLinks.ceo : ui.navLinks.vc;
                const navKey = pageName.replace('vc-', '');
                Object.values(navMap).forEach(link => link?.classList.remove('active'));
                navMap[navKey]?.classList.add('active');
                
                if (ui.sidebar.classList.contains('translate-x-0')) {
                    ui.sidebar.classList.remove('translate-x-0');
                    ui.sidebar.classList.add('-translate-x-full');
                }
            }
            
            function initializeDictationService(apiKey) {
                dictationService = new DictationService({
                    apiKey: apiKey, recordButton: ui.recordButton, statusTextElement: document.getElementById('recording-status-text'),
                    onRecordingStart: () => ui.recordingInterface.classList.remove('hidden'),
                    onRecordingStop: () => {
                        showPage('recording'); ui.recordingInterface.classList.add('hidden'); ui.processingState.classList.remove('hidden'); ui.completedState.classList.add('hidden'); ui.processingStatus.textContent = 'Transcribing audio...';
                    },
                    onProcessingComplete: (data, rawText, error) => {
                         latestGeneratedReport = { ...data, raw: rawText };
                         renderCompletedState(latestGeneratedReport);
                         ui.processingState.classList.add('hidden');
                         ui.completedState.classList.remove('hidden');
                    }
                });
                updateRecordButtonState();
            }

             function renderCompletedState(data) {
                if (data.error) {
                    ui.extractedIntelligenceContainer.innerHTML = `<h4 class="font-bold text-sm mb-4">Error</h4><div class="bg-white p-6 border border-red-200 rounded-lg"><p class="text-red-600">${data.error}</p></div>`;
                    ui.strategicUpdateContainer.innerHTML = `<h4 class="font-bold text-sm mb-4">Strategic Update</h4><div class="bg-white border-2 border-gray-200 p-6 rounded-lg shadow-lg"><p class="text-gray-500">Could not be generated due to an error.</p></div>`;
                    return;
                }

                const renderList = (items) => items && items.length > 0 ? `<ul>${items.map(item => `<li class="flex items-start gap-2"><span class="text-purple-600">→</span><span>${item}</span></li>`).join('')}</ul>` : '<p class="text-gray-500">None mentioned.</p>';
                 const fullSummaryHtml = data.fullSummary ? marked.parse(data.fullSummary) : '<p class="text-gray-500">Summary not available.</p>';


                const intelligenceHtml = `
                    <div class="space-y-4">
                        <div><h4 class="font-bold text-sm mb-2 text-green-600">Key Wins</h4>${renderList(data.wins)}</div>
                        <div><h4 class="font-bold text-sm mb-2 text-amber-600">Key Challenges</h4>${renderList(data.challenges)}</div>
                        <div><h4 class="font-bold text-sm mb-2 text-blue-600">Strategic Insights</h4>${renderList(data.insights)}</div>
                        <div class="pt-4 border-t"><h4 class="font-bold text-sm mb-2">Full Transcript</h4><p class="text-xs italic text-gray-500 max-h-32 overflow-y-auto">${data.raw || 'Not available.'}</p></div>
                    </div>`;
                ui.extractedIntelligenceContainer.querySelector('.bg-white').innerHTML = intelligenceHtml;
                
                const strategicHtml = `
                    <div class="flex items-center justify-between mb-6"><div><h3 class="font-bold text-xl">Strategic Update</h3><p class="text-sm text-gray-600 mono">Week ${new Date().getWeek()} • ${new Date().getFullYear()}</p></div><span class="text-sm bg-green-100 text-green-800 px-3 py-1 rounded-full">Momentum Building</span></div>
                     <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="text-center p-3 bg-gray-50 rounded"><p class="font-bold text-xl">${data.arr || 'N/A'}</p><p class="text-xs text-gray-600">ARR</p></div>
                        <div class="text-center p-3 bg-gray-50 rounded"><p class="font-bold text-xl ${data.growth && data.growth.startsWith('+') ? 'text-green-600' : 'text-red-600'}">${data.growth || 'N/A'}</p><p class="text-xs text-gray-600">Growth</p></div>
                        <div class="text-center p-3 bg-gray-50 rounded"><p class="font-bold text-xl">${data.runway || 'N/A'}</p><p class="text-xs text-gray-600">Runway</p></div>
                    </div>
                    <div class="prose prose-sm max-w-none">${fullSummaryHtml}</div>
                    <button id="finalize-report-btn" class="mt-6 w-full bg-purple-700 text-white py-2 text-sm font-bold hover:bg-purple-800 transition-colors rounded-md">Save & Finalize Report →</button>
                `;
                ui.strategicUpdateContainer.querySelector('.bg-white').innerHTML = strategicHtml;
                document.getElementById('finalize-report-btn').addEventListener('click', () => {
                    addNewReport(latestGeneratedReport);
                    showPage('reports');
                });
            }
            
            Date.prototype.getWeek = function() { var d = new Date(Date.UTC(this.getFullYear(), this.getMonth(), this.getDate())); var dayNum = d.getUTCDay() || 7; d.setUTCDate(d.getUTCDate() + 4 - dayNum); var yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1)); return Math.ceil((((d - yearStart) / 86400000) + 1)/7) };
            
            function updateRecordButtonState() {
                const isReady = dictationService && dictationService.isReady();
                const buttons = [ui.startRecordingBtn, ui.recordButton, ui.newReportBtn];
                buttons.forEach(btn => {
                    if (btn) {
                        btn.disabled = !isReady; btn.style.cursor = isReady ? 'pointer' : 'not-allowed'; btn.style.opacity = isReady ? '1' : '0.5'; btn.title = isReady ? 'Start Recording' : 'API Key not configured';
                    }
                });
                ui.apiKeyBanner.classList.toggle('hidden', isReady);
            }

            function saveApiKey() {
                const apiKey = ui.apiKeyInput.value.trim();
                if(apiKey) {
                    localStorage.setItem('geminiApiKey', apiKey);
                    initializeDictationService(apiKey);
                    ui.apiKeyStatus.textContent = 'API Key saved!';
                     setTimeout(() => {
                        ui.apiKeyStatus.textContent = '';
                        if (dictationService.isReady()) showPage('dashboard');
                    }, 2000);
                }
            }
            
            function switchView() {
                const isVcView = ui.viewToggle.checked;
                currentView = isVcView ? 'vc' : 'ceo';
                ui.ceoView.classList.toggle('hidden', isVcView); ui.vcView.classList.toggle('hidden', !isVcView); ui.ceoNav.classList.toggle('hidden', isVcView); ui.vcNav.classList.toggle('hidden', !isVcView);
                if (isVcView) {
                    ui.userName.textContent = 'Sarah (Partner)'; ui.userCompany.textContent = 'Alpha Ventures'; ui.userAvatar.src = 'https://placehold.co/100x100/8B5CF6/FFFFFF?text=S';
                    ui.vcLabel.classList.add('font-semibold', 'text-purple-700'); ui.vcLabel.classList.remove('text-gray-500'); ui.ceoLabel.classList.remove('font-semibold', 'text-purple-700'); ui.ceoLabel.classList.add('text-gray-500');
                    showPage('vc-dashboard');
                } else {
                    ui.userName.textContent = 'Alex (CEO)'; ui.userCompany.textContent = 'Acme Inc.'; ui.userAvatar.src = 'https://placehold.co/100x100/5B21B6/FFFFFF?text=A';
                    ui.ceoLabel.classList.add('font-semibold', 'text-purple-700'); ui.ceoLabel.classList.remove('text-gray-500'); ui.vcLabel.classList.remove('font-semibold', 'text-purple-700'); ui.vcLabel.classList.add('text-gray-500');
                    showPage('dashboard');
                }
            }
            
            function showModal(title, body) {
                ui.modalTitle.textContent = title;
                ui.modalBody.innerHTML = '';
                ui.modalBody.appendChild(body);
                ui.modal.classList.remove('hidden');
                setTimeout(() => { ui.modalOverlay.classList.remove('opacity-0'); ui.modalContent.classList.remove('scale-95', 'opacity-0'); }, 10);
            }

            function hideModal() {
                ui.modalOverlay.classList.add('opacity-0');
                ui.modalContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => ui.modal.classList.add('hidden'), 300);
            }
            
            function showViewReportModal(reportId) {
                const report = db.reports[reportId]; if (!report) return;
                const content = document.createElement('div');
                const growthClass = report.metrics.growth.startsWith('+') ? 'text-green-600' : 'text-red-600';
                content.innerHTML = `
                    <div class="grid grid-cols-3 gap-4 mb-6 text-center">
                        <div><p class="font-bold text-2xl">${report.metrics.arr}</p><p class="text-xs text-gray-600">ARR</p></div>
                        <div><p class="font-bold text-2xl ${growthClass}">${report.metrics.growth}</p><p class="text-xs text-gray-600">MoM Growth</p></div>
                        <div><p class="font-bold text-2xl">${report.metrics.runway}</p><p class="text-xs text-gray-600">Runway</p></div>
                    </div>
                    <div class="prose prose-sm max-w-none">${report.content}</div>`;
                showModal(report.title, content);
            }
            
            // Other functions (populateCeoPlaybooks, populateVcPortfolio, etc.) are unchanged
            // but are included here for completeness.

            function populateCeoPlaybooks() {
                const activeCategories = Array.from(ui.playbookCategoryFilters.querySelectorAll('.playbook-category-btn.active')).map(btn => btn.dataset.category);
                const categories = { 'Growth': [], 'Hiring': [], 'Fundraising': [], 'Product': [], 'Sales': [], 'Legal': [] };
                let visiblePlaybooks = Object.entries(db.playbooks).filter(([id, playbook]) => playbook.category && (activeCategories.length === 0 || activeCategories.includes(playbook.category)));

                if (visiblePlaybooks.length === 0) {
                    ui.ceoPlaybookList.innerHTML = `<div class="text-center text-gray-500 col-span-full">No playbooks found for the selected categories.</div>`;
                    return;
                }

                visiblePlaybooks.forEach(([id, p]) => {
                    const html = `
                        <div class="bg-white border border-gray-200 p-4 rounded-lg flex justify-between items-center group">
                            <div>
                                <p class="font-semibold">${p.title}</p>
                                <p class="text-sm text-gray-500">from ${p.company}</p>
                            </div>
                            <button class="playbook-view-btn text-xs bg-gray-200 text-gray-700 px-3 py-1 rounded-full font-semibold hover:bg-gray-300" data-playbook-id="${id}">View</button>
                        </div>`;
                    if(categories[p.category]) categories[p.category].push(html);
                });
                
                let fullHtml = '';
                for (const [categoryName, items] of Object.entries(categories)) {
                    if (items.length > 0) {
                        fullHtml += `<div><h3 class="font-bold mb-4 pb-2 border-b border-gray-200">${categoryName}</h3><div class="space-y-4 text-sm">${items.join('')}</div></div>`;
                    }
                }
                
                ui.ceoPlaybookList.innerHTML = fullHtml;

                document.querySelectorAll('#ceo-playbook-list .playbook-view-btn').forEach(link => {
                    link.addEventListener('click', (e) => { e.preventDefault(); e.stopPropagation(); /* showPlaybookModal(e.currentTarget.dataset.playbookId); */ });
                });
            }

            function populateVcPortfolio() {
                let html = '';
                for (const [id, company] of Object.entries(db.companies)) {
                     const statusClass = company.status === 'On Track' ? 'text-green-800 bg-green-100' : 'text-yellow-800 bg-yellow-100';
                     const growthClass = company.metrics.growth.startsWith('+') ? 'text-green-600' : 'text-red-600';
                    html += `
                        <div class="bg-white border border-gray-200 p-6 rounded-lg cursor-pointer hover:shadow-lg transition-shadow" data-company-id="${id}">
                            <div class="flex justify-between items-start mb-4">
                                <h3 class="font-bold">${company.name}</h3>
                                <span class="px-2 py-1 text-xs font-semibold ${statusClass} rounded-full">${company.status}</span>
                            </div>
                            <div class="grid grid-cols-3 gap-4 text-center">
                                <div class="border-r border-gray-200"><p class="text-lg font-bold">${company.metrics.arr}</p><p class="text-xs text-gray-500">ARR</p></div>
                                <div class="border-r border-gray-200"><p class="text-lg font-bold ${growthClass}">${company.metrics.growth}</p><p class="text-xs text-gray-500">MoM</p></div>
                                <div><p class="text-lg font-bold">${company.metrics.runway}</p><p class="text-xs text-gray-500">Runway</p></div>
                            </div>
                        </div>`;
                }
                ui.vcPortfolioList.innerHTML = html;
                document.querySelectorAll('#vc-portfolio-list > div').forEach(card => card.addEventListener('click', (e) => { e.preventDefault(); /* showCompanyDetailModal(e.currentTarget.dataset.companyId); */ }));
            }
            
            // Event Listeners Setup
            Object.entries(ui.navLinks.ceo).forEach(([name, link]) => link?.addEventListener('click', (e) => { e.preventDefault(); showPage(name); }));
            Object.entries(ui.navLinks.vc).forEach(([name, link]) => link?.addEventListener('click', (e) => { e.preventDefault(); showPage(`vc-${name}`); }));
            
            ui.bannerSettingsLink.addEventListener('click', (e) => { e.preventDefault(); showPage('settings'); });
            ui.mobileMenuBtn.addEventListener('click', () => { ui.sidebar.classList.toggle('-translate-x-full'); });
            ui.startRecordingBtn.addEventListener('click', () => dictationService?.toggleRecording());
            if(ui.newReportBtn) ui.newReportBtn.addEventListener('click', () => showPage('dashboard'));
            ui.saveApiKeyBtn.addEventListener('click', saveApiKey);
            ui.viewToggle.addEventListener('change', switchView);

            if(ui.authorPlaybookBtn) ui.authorPlaybookBtn.addEventListener('click', () => {});

            document.querySelectorAll('#page-vc-playbooks .playbook-link').forEach(link => link.addEventListener('click', (e) => { e.preventDefault(); }));
            
            ui.modalCloseBtn.addEventListener('click', hideModal);
            ui.modalOverlay.addEventListener('click', hideModal);
            
            ui.playbookCategoryFilters.addEventListener('click', (e) => {
                const targetButton = e.target.closest('.playbook-category-btn');
                if (targetButton) {
                    targetButton.classList.toggle('active');
                    populateCeoPlaybooks();
                }
            });

            // Initial Load
            const savedApiKey = localStorage.getItem('geminiApiKey');
            if (savedApiKey) ui.apiKeyInput.value = savedApiKey;
            initializeDictationService(savedApiKey);
            loadReports();
            populateCeoPlaybooks();
            populateVcPortfolio();
        });
    </script>
</body>
</html>
